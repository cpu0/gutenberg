General Disclaimer 


One or more of the Following Statements may affect this Document 


• This document has been reproduced from the best copy furnished by the 
organizational source. It is being released in the interest of making available as 
much information as possible. 


• This document may contain data, which exceeds the sheet parameters. It was 
furnished in this condition by the organizational source and is the best copy 
available. 


• This document may contain tone-on-tone or color graphs, charts and/or pictures, 
which have been reproduced in black and white. 


• This document is paginated as submitted by the original source. 


• Portions of this document are not fully legible due to the historical nature of some 
of the material. However, it is the best reproduction available from the original 
submission. 


Produced by the NASA Center for Aerospace Information (CASI) 



DOE/NASA TECHNICAL 
MEMORANDUM 


DOE/NASA TM-78291 


SOLAR SITE TEST MODULE 


By Ralph R. Kissel and Donald R. Scott 
Electronics and Control Laboratory 


National Aeronautics and Space Administration 
George C. Marshall Space Flight Center, Alabama 35812 


July 1980 




U.S. Department of Energy 



Solar Energy 


A viUMi-: « '«r \ 


TABLE OF CONTENTS 


Page 


INTRODUCTION 1 

SDAS INTERFACE 2 

TEST MODULE 3 

PROGRAM FEATURES 3 

SITE DATA PREPARATION 4 

OTHER CONSIDERATIONS 5 

SUMMARY 5 

APPENDIX A SDAS - AIM 65 CABLE CONNECTIONS AND 

INTERFACE SIGNAL DESCRIPTION 7 

APPENDIX B PULSE STRV^CHER CIRCUIT 10 

APPENDIX C 6502 ASSEMBLER PROGRAM TO INTERROGATE 

SDAS 11 

APPENDIX D BASIC PROGRAM DESCRIPTION 15 

APPENDIX E INPUT FORMATS 21 

APPENDIX F OPERATING INSTRUCTIONS 25 


fc* * 

PRECEDING page BLANK NOT FILMtJ 

... 

Ill 


LIST OF ILLUSTRATIONS 


Figure Title Page 

1 Test module package 2 

A • 1 SI) AS signals and timing. 9 

B- 1 Pulse stretcher 10 

C“1 Assembler listing 13 

D-l BASIC program listing 18 

D-2 Typical full printout for 32 channel system 20 

LIST OF TABLES 

Table Title Page 

A-l Cable Connections 7 

A- 2 Recorder Connections 8 


iv 



TECHNICAL MEMORANDUM 


SOLAR SITE TEST MODULE 

INTRODUCTION 


The Department of Energy (DOE), in conjunction with the National 
Aeronautics and Space Administration /Marshall Space Flight Center (NASA/ 
MSEC), supports numerous commercial solar heating and cooling system 
installations throughout the country. These systems are to demonstrate 
the use of solar energy and are referred to as demonstration solar sites 
or simply as solar sites. 

Solar sites may be divided into two categories, instrumented and 
uninstrumented. An instrumented site has an abundance of sensors 
mounted in strategic places for the sole purpose of gathering data from 
that site. The analog output of these sensors is routed to a central 
location called a J-box, then into a box called a site data acquisition sys- 
tem (SDAS) where the data are converted to digital form. These digital 
data are then stored on a tape and once a day transmitted via telephone 
to a central location for compilation and analysis. These sites permit 
convenient access to the sensor data through a connector on the side of 
the SDAS. This report describes a troubleshooting tool, an AIM 65 micro- 
computer, that interfaces with that connector to read all the sensor 
information and perform calculations as required. Uninstrumented sites 
have neither an SDAS nor the sensors to use with it. 

A solar site troubleshooting team needs immediate information about 
the site they are checking. Problems can be found and corrected without 
delay. The test module described here serves to collect that information 
and present it immediately in calibrated engineering units. Remote data 
are not available until at least the next day. 

Older IBM units, the DCM (digital count monitor) and OSM (on-site 
monitor), were deficient in that they were not easily portable (especially 
OSM), usually had no printer, produced only decimal counts (DCM), or 
else did not produce a periodic output greater than 2 sec. These units 
operate only with instrumented sites. The test, module described here 
presently has that limitation also. 

The test module is basically the Rockwell AIM 65 microcomputer 
adapted to this application. It will manually read one sensor, periodically 
read up to 10 sensors, or periodically read all sensors. Performance data 
are assigned a channel number and treated like any sensor channel. 

Results can be printed whenever a hard copy is needed. 


The tost module package (Figure 1) consists of the computer and 
carrying case, the cassette recorder /player, the cable between the com 
puter, SDAS and recorder, ami a cassette tape containing the program 
and site data. 



Figure 1. Test Module Package. 


SDAS 1NT E It FACE 


All sites where this test module is used must have an SDAS installed 
there. A fundamental design requirement was to know what all signals 
entering and leaving the test plug were and exactly how each was related 
to the other. Some of this information was not available from II. M and 
had to be measured. A 1(5 channel logic analyzer was used to do this. 
Appendix A contains details concerning interface signals and cable. 

Using this information and knowing that the SDAS hardware interface is 
TTL compatible indicated that the AIM 65 hardware would bo compatible 
and allowed an assembler software routine to be written to interrogate the 
SDAS. Appendix C contains details of this t>502 software routine. 

One problem encountered was that the strobe from the SDAS which 
signaled that the data was stable on the data lines was too short to 
activate reliably the interface device on the AIM 65. A pulse stretcher 
circuit was added which increased the strobe width from 200 to 700 ns and 
proper operation was achieved. Appendix M contains details on the pulse 
stretcher circuit. 


mST MODULE 


The AIM 65 has many features that make it well suited to this task. 

It is small enough to be hand carried onboard a plane. The unit already 
built into a small carrying case is now available. Future units purchased 
for this task should be ordered this way 

It has a 20- column printer for permanent data records and has a 
20-column display which is needed for user-prompt messages. It can 
store programs and data on most any cassette recorder. It uses the 
BASIC language which was designed for ease of man-machine communication. 
It also can use assembler language which allows the high speed necessary 
for communication with the S1)AS. It has a full size keyboard vMeh, with 
BASIC, allows site data to be stored or modified at the site if necessary. 

It includes 4Iv memory (RAM) which is adequate for this task. It costs 
approximately $600. 

The particular recorder currently being used is one that was 
already available to the solar program. It cost approximately $40. When 
used for recording, the tape gap between records had to be increased 
somewhat from the default value in the AIM 65 monitor, but this is not 
unusual. Other recorders may or may not need this change. Recorder 
connections depend heavily upon the particular recorder being used and 
are described in the AIM 65 literature. 

The cable must match the SDAS on one end and have at least a 
44-pin printed circuit board connector on the other. The cable now being 
used is similar to that already being used with the SDAS . Future cables 
to the test module could be smaller in diameter and/or longer with an 
enclosed connector on the test module end. The recorder connections 
come off the same 44 pin connector as the SDAS lines. There are only 
three plugs to the recorder: audio in, audio out, and power (which is 

remotely controlled). Good quality tape is preferred and a backup copy 
is maintained in any ease. 


PROGRAM FEATURES 


The software package is written entirely in BASIC as one program. 

It includes the machine language program (to read the SDAS) as* an 
integral part. It automatically cheeks for the proper number of parameters 
in the site description data. It is loaded from tape in one. operation by 


BASIC. 


It gives the user three main options: (1) Manually look at any 

channel, (2) periodically look at one to ten channels, or (3) periodically 
(or one time) look at all channels. The output can be printed or not as 
desired. Naturally, printout would be used for automatic, unattended 
operation. See Appendix I) for the BASIC program description and 
Appendix F for program operating instructions. 


3 


The SDAS read portion always accepts an entire scan of data as 
fast as it comes from the SDAS. Then any processing and printout are 
done using this one simultaneous data set no matter how long it takes to 
actually print the results. In case the SDAS is busy when a data set is 
requested, the SDAS is rechecked every 2 sec until a da L a set is received 
or until the computer is interrupted. If a wire came loose, for example, 
the computer would print TIMEOUT and never do anything more until the 
problem was solved. 

A portion of the program is used only for site data as taken from 
the IP (instrumentation program) for that site. This is normally set up 
on tape ahead of time as it will generally require about 4 hr to do. Once 
on site, channels (sensor or performance) may be updated, added or 
deleted as needed and new results obtained immediately. 

It is possible to store data on tape for later use, although it is not 
now an automatic feature. Full, automatic printout should reduce the need 
for any such data storage virtually to zero, especially in the present 
troubleshooting application. 

Results are given to 0.1°F for temperature and to approximately 
0.1 percent for all other outputs. Outputs will be given to 0.1 units as 
a standard format. 


SITE DATA PREPARATION 


The primary item needed to prepare data for the computer is the 
site IP; from it, all sensor channels with their calibration coefficients and 
units are available. Instantaneous performance parameters can also be 
defined using the IP. 

Sensor channels are defined to the computer by assigning a program 
lin.e number from 1000 to 1999 for each sensor, then giving the channel 
number, the calibration coefficients and the units code on that same line. 
In the case of a temperature sensor, a fixed scaling is used to save mem- 
ory (no decimal point and no exponents needed). 

Instantaneous performance parameters are also assigned a channel 
number and the data to the computer then consist of the temperature and 
flow channel numbers with the proper units code. For liquid tlow, a 
fourth channel is specified which contains the specific heat and density 
coefficients. For insolation, the collector area is needed and for air sys- 
tems, the duct area is needed also. 

Once all the channels are specified, only a few minutes are needed 
to enter them into the computer. Running the program will automatically 
do considerable error checking, particularly as to whether the proper 
number of parameters was used for each channel. Once all is in order, 


4 


the complete program with site data can be recorded on tape for use at 
the site. Changes at the site can be entered just as in the initial pre- 
paration, and they can be either temporary or permanent changes depend- 
ing on whether or not they are stored on tape. See Appendix E for 
further details on site data format. 

A tape log is always needed to show what programs (or data) are 
on a particular tape and where on the tape they are located (from tape 
counter, etc.). 


OTHER CONSIDERATIONS 


The present 4K user memory will handle the complete primary pro- 
gram and approximately 60 channels of data. Splitting the program into 
two parts (i.e., two tape loads) will allow about 25 more channels to be 
added. Each IK memory allows about 40 channels to bo added. Memory 
can be added from 8K more to 32K more by simply buying it. The pro- 
cessor can address up to 64K bytes easily. 

AIM 65 speed should always bv< more than enough for any solar 
energy application. It is capable of lengthy performance calculations 
if the need arises. In the present application, there is some delay (a 
few seconds) in searching out some required channels. This delay could 
be reduced just to that required by the printer if another 2Iv of memory 
were available. 


Portability, even for the older size unit, has already been demon- 
strated. The unit has been put inside a large carry-on briefcase and 
fits under the airplane seat. A portable unit with built-on handle is now 
available from at least one manufacturer and is even smaller than what 
has been used here. The complete AIM 65 with enclosure and power sup - 
ply weighs approximately 10 lb and approximately half of that is power 
supply weight. 

Many accessory and expansion boards are available for the AIM 65, 
and others are continually being introduced. There are larger memories, 
video boards, PROM programmers, DISK system, more I/O, etc. 32K 
memory can be purchased for less than $400. 


SUMMARY 


The AIM 65 solar site checkout test module is a readily available, 
low-cost, portable unit well suited for solar site measurements. The 4Iv 
memory version, with some compromises, is adequate to use at all instru- 
mented sites. It is expandable in capability, should the need arise, to 


do other tusks such us full-scale performance analysis and automatic real- 
time site control. A data acquisition module could be added, probably 
inside the present module, to check out uninstrumented sites once a way 
to get data to the module is worked out. Either way, the module will 
monitor one or more channels at fixed time intervals and print out the 
results, if desired. It can be reprogrammed on site to accommodate sys- 
tem parameters that are found to be different than expected. 


6 


APPENDIX A 


SDAS - AIM 65 CABLE CONNECTIONS AND 
INTERFACE SIGNAL DESCRIPTION 


The following table shows the signal line descriptions and their pin 
numbers on both ends of the cable. 


TABLE A-l. CABLE CONNECTIONS 


SDAS SIGNAL 

OSM PIN 

AIM 65 J1 PIN 

6522 

STROBE 

13 

20 i 

CA1 

STROBE 

- 

18 ' 

CB1 

INTR. REQUEST 

11 

21 

CA2 

D7 

29 

14 

A0 

D6 

28 

4 

A1 

D5 

27 

3 

A2 

D4 

26 

2 

A3 

Dvi 

25 

5 

A4 

D2 

24 

6 

A5 

D 1 

23 

7 

A 6 

D 0 

22 

8 

A7 

INTR. POLL 

10 

13 

B4 

FCT 0 

14 

16 

B5 

CARD SEL. 

9 

17 

B6 

FCT 1 

15 

15 

B7 

CONNECTED 

32 

K-| 

- 

GROUND 

33 

1 ' 

- 

SEL. ACK. 

12 

17 

B 6 


Select Acknowledge wus connected directly to Card Select on the 
AIM .65 end since a very fast response was required (<.75 ys). Pins 
18 and 20 on AIM 65 J1 are connected so that both interrupt inputs see 
the same strobe signal. The OSM connected (5 mA) and signal return lines 
from the SDAS are connected to ground on the AIM 65 J1 connector. So 
anytime the cable is plugged into the e’LiAS , all that is required to inter- 
rogate the 3D AS is an active low on the Interrupt Request lino. With 
this wiring choice, the only output from the AIM 65 itself is on the 
Interrupt Request lino. The Power-On and Select-Acknowledge signals 
to the £BAS are hardwired. All other signal lines are inputs to the AIM 
65. Pin K has no AIM 65 connection and was used as a ground tiepoint. 

Recorder connections depend on the recorder used and must be 
worKed out according to the AIM 65 instructions. The recorder used here 
was negative ground with plug shells being ground. The connections to 
AIM 65 J1 for remote control of this one recorder (Tl) are as follows: 


TABLE A- 2. RECORDER CONNECTIONS 


FUNCTION 


J1 PIN 


POWER (Remote) 

EARPHONE 

MICROPHONE 

+5V to TRANSISTOR 

SHELLS (GND) 


E 


L 

M 

A to F (JUMPER) 
1 or K 


Figure A-l shows the SDAS detailed signal and timing chart as 
measured on a Tektronix logic analyzer. IR initiates the data scan, IP 
and CS are SDAS replies and SA is the required reply back to the SDAS. 
IR is raised in response to the strobe from the SDAS. 

The four bytes for the RTC are then sent and strobed in as shown. 
CS is used to generate SA. Note that the second data byte of each pair 
is on the line about 3 ys compared to the first byte time of around 
570 ys. The strobe, however, comes 1.2 ys after the data is on the line 
in all cases. 

There is a long wait before the first channel is sent while the off- 
set is being determined. After the first channel (offset) is sent, all the 
other channels are sent in order. FI is active while the last existing 
channel is being sent. FI is therefore used to signal that there will be 
no more data. 


STROBE 


.2 


if- 

T 


1.2 /iS 


ITT” 

-iPir 1 - 2 

HIGH MID 


TT 


LOW LOW 


ALL SIGNALS ACTIVE LOW 


S 1 

HI LO 

CHI 


(USUALLY ZERO) 


^ r 

HI LO 
CH2 


SCAN REQUEST 


REAL TIME CLOCK 


OFFSET 


DATA 


— r~ 

LAST CH (48) 

dat/TI 


Figure A-l« SDAS signals and timing. 







APPENDIX B 


PULSE STRETCHER CIRCUIT 


It was intended that the AIM 05 would be directly interfaced to the 
SDAS without modification. It turned out that the 200 ns strobe from the 
SDAS is too short to permit reliable operation of the 6522 interface IG in 
the AIM 65. It was therefore necessary to add a monostable flip-flop in 
series with the strobe line to stretch the strobe (as seen by the 6522) to 
700 ns. The circuit shown in Figure B-l does this, but it could be imple- 
mented in several other ways. The 54123 was used because it was on 
hand (dual monostable). 


+5Vo o+5V 



SN54123 

1 2 3 4 5 6 7 8 


>— J ^ 

SDAS STROBE iN 0+5V 


Q 

OUTPUT 


NC 


Figure B-l. Pulse stretcher. 

The Q pulse stretcher output was wired to pins 18 and 40 on the 
6522 socket for convenience rather than to connector Jl. The +5V was 
taken off Jl pin A and ground was Jl pin 1. The strobe is taken off : 
either pin 18 or 20 on Jl. Pins 18 and 40 on the 6522 were lifted out of 
their sockets and soldoring was then done directly to them. This avoided 
cutting lines on the PC board. 


10 



APPENDIX C 


6502 ASSEMBLER PROGRAM TO INTERROGATE SDAS 


The AIM 65 was programmed in machine language to read the SDAS 
because BASIC would be far too slow. The machine language program 
is called by BASIC when a scan is needed. The program initiates the 
scan request, uses the first strobe tc recognize that the SDAS replied 
and uses all later strobes to latch in the data bytes. 

The 6522 interface chip is set up to latch data whenever a strobe 
is seen and to latch it on the strobe trailing edge. Noise on the data 
lines was sometimes seen on the strobe leading edge. 

As soon as the IR line is lowered, the processor begins looking for 
the strobe reply. As soon as it is seen, it raises IR, starts a 64 ms n 
timer and begins looking for CS and F0 to become active. If no first 
strobe is seen after looking 255 times ( — 3.6 ms) the program raises IR 
and goes back to BASIC with zero as the number of strobes seen. BASIC 
uses this to inform the user that the timeout was caused by no reply from 
the SDAS. 

If CS and F0 are not seen and a timeout occurs, the program goes 
back to BASIC with 200 as the number of strobes seen. This informs the 
user that the timeout was not caused by no reply from the SDAS but by 
noise, a hardware glitch, malfunctioning SDAS, etc. 

Once CS and F0 are seen, a search is started for the first of two 
strobes. If no strobe is seen before 64 ms are up, 200 is again sent 
back to BASIC. When the strobe is seen, the data are read, inverted to 
active high, and stored in the next sequential location in memory. After 
the second of the strobe pair is processed, a check is made to see if FI 
was active along with CS and F0 . If it was, the program goes back to 
BASIC since the scan is done. If it was not, the program gets the next 
two bytes. 

If a strobe is missed somewhere along the line, a timeout will occur 
with 200 returned indicating a problem. An extra strobe will also cause 
this. An even number missed will not timeout, but will only give a chan- 
nel count that is wrong and the data will probably make little sense, since 
at least some of it will be in the wrong place in memory. Strobes will not 
be missed when the equipment is working properly. 

CS and F0 are checked, rather than just relying on strobes alone 
because false strobes (or noise) were seen at times when CS and F0 were 
not active during the scan. F0 is used with CS for better reliability, 
although CS should be sufficient by itself. 


11 


The S1)AS transmits an orroi* word ( l'l' , FF) if for Homo reason it 
does not see SA. Since SA is hardwired, no specific provision is made 
for that ease although the data would reflect this in the event that a 
timeout did not occur in the assembly program. 


It should be noted that, as is visible in Appendix A, the HIM MSI! 
is 0 while for the AIM 65, the MSI1 is 7. This is taken care of in the 
cable wiring. 

Further details can be obtained from the Assembler program listing 
which follows in Figure C 1. 


\12 


*--$0F8E< SF'GM START AAR 
LOCI «*0EC7 » DATA START AliR 
UDRB ~$ AOOO 
UDRAFb$AOOi 
UBDRB~$A002 
UDDRA 5: $A003 


UACR 

= :$AOOB 


UPGR 

=$AOOC 


UIFR 

“$AOOD 


UT2H 

C ~$A009 



LDA 

UIFR 



STA 

UIFR 

i CLR INTR'S 


LDA 

*0 



STA 

UDDRA 

sa all in 


STA 

UDDRB 

SB ALL IN 


LDA 

*03 



STA 

UACR 

S ENABLE A t B LATCHES 


LDA 

*$1D 



STA 

UPCR 

?CA2(IR> LGUfINTR ON TRAIL 


LDX 

*0 

S DELAY CNTR 


LDY 

*0 

S STROBE CNTR 

LOOP1 

INX 




CPX 

*0 

S DELAYED 255? 


BEQ 

TIME 

SYES-SDAS BUSY 


LDA 

*$12 

S STROBE MASK 


CMP 

UIFR 

S STROBE YET? 


BNE 

L.00P1 

> NO » WAIT 


LDA 

*$1F 



STA 

UPCR 

SIR HIGH 

LOOF'3 

LDA 

*$FF 

S ,06-1 SEC 


STA 

UT2H 

S START TIMER 

L00P2 

LDA 

UDRB 



AND 

*$60 

S FO > CS MASK 


BEQ 

SP0T1 

SOFFiWAIT 


LDA 

UIFR 



AND 

*$20 

i CK TIMEOUT 


BEQ 

L00P2 

SNONErCONT 


BNE 

HDW 

S PROBLEM 

SPOT 1 

LDX 

*02 

SBET PAIR STROBES 

LOOPS 

LDA 

*$12 



STA 

UIFR 

f CLR IRAfB-NOT T2 

LQQP4 

LDA 

UIFR 



CMP 

*$12 



BEL 

SP0T2 

fSTR SEEN 


CMP 

*$20 

? CK T2 


BNE 

L00P4 

SNONEfWAIT 

HDW 

LDY 

*200 

f 200 TO BASIC 


BNE 

TIME 

» JMP 

SPOT 2 

LDA 

UDRAH 

SLOAD DATA f CLR IRA 


EOR 

*$FF 

STO ACTIVE HIGH 


STA 

LOCI f Y 

f STORE NEXT 


INY 




DEX 


SB LATCH ON 2ND STROBE 


BNE 

1 OOPS 

S GET 2ND STR 


LDA 

UDRB 

f CLR IRB 


AND 

* $ E. 0 

fCSfFOfF'1 all active? 


BNE 

LOOP 3 

f NO r MOLE DATA 

TIME 

LDA 

*$1F 



STA 

UP 

SIR HIGH 


LDA 

*0 

SFOR BASIC 


JMP 

$coru 

f BACK 10 BASIC 


• END 


Figure C-l. Assembler listing 


OF'BB 

ad 

LftA 

AO Oft 

or- BE 

ft ft 

STA 

A 00 ft 

OF 91 

A 9 

1. ft A 

100 

OF 9? 

ft ft 

ST A 

AGO? 

OF 9 6 

< j ft 

ST A 

A002 

OF 99 

A 9 

LftA 

1 03 

0F9B 

ft ft 

ST A 

A OOF 

0F9E 

A 9 

LftA 

i 111 

or oo 

ft ft 

ST A 

AOOC 

or A3 

A 2 

L.ftX 

<00 

0FA5 

AO 

u;iv 

100 

OFA7 

Fft 

I NX 


OF A 8 

EO 

CP* 

100 

OF A A 

ro 

BEQ 

Of F 6 

OFAC 

A 9 

LftA 

1 12 

OFAE 

t ft 

CMP 

AO Oft 

OFB1 

no 

ft NIL 

Of A? 

OF ft 3 

A 9 

LftA 

a if 

OF ft 5 

ft ft 

STA 

A i Hm: 

OF ft ft 

A v 

1. HA 

IFF 

OF ft A 

ft ft 

SI A 

A 00 

OFU ft 

Aft 

LftA 

A AO ft 

or so 

29 

AN ft 

«A0 

oi- or; 

1-0 

ftC.U 

Oft, ft 

or 04 

Aft 

LftA 

AO Oft 

OF 07 

29 

A Nil 

S 20 

0FC9 

ro 

BP Cl 

or ft ft 

orc;ft 

1. 10 

BNL 

Of ftl 

or on 

A? 

LUX 

HO,:.; 

OF OF 

A 9 

LftA 

n i 2 

or in 

ft ft 

STA 

A OR. 

OF Vi 4 

Aft 

LftA 

A 00 ft 

OF 11 7 

1:9 

CMP 

a i ? 

OF ! 9 

ro 

mi 

of?.:*' 

OF lift 

< o 

CAP 

120 

ci ; in:i 

ftO 

ft Np 

OF ft 4 

OP ftp 

AO 

I.IIY 

lies 

OF FI 

ftO 

ft Nr 

>M FA 

on;: 3 

AD 

LftA 

AO 01 

OP E6 

49 

FOR 

in 

or re 

oq 

STA 

ore? 

OF Eft 

IV ft 

I NT 


OP CO 

CA 

HEX 


OR D 

no 

b Nr: 

orcF 

orcr 

Aft 

IJ1A 

A 000 

OFF? 

2 9 

AND 

1 EO 

OFF 4 

DO 

BNE 

OF ft 8 

OP F6 

A 9 

L CIA 

i i.r 

OFF ft 

ft ft 

STA 

AOOC 

OFF ft 

A? 

LftA 

400 

OFF ft 

4C 

JNP 

('• >1: 1 


end 


Figure Ol. (Concluded). 


14 



APPENDIX D 


BASIC PROGRAM DESCRIPTION 


This program contains the software necessary to interrogate the 
SDAS , store each byte of data from the SDAS , and process and print 
the data in engineering* units. It can do this for various combinations of 
channels or for all channels at time intervals of 2 sec or more and do it 
unattended if desired. 

The software necessary to interrogate the SDAS was first written 
in assembler language then converted into decimal so BASIC could load it 
into the proper memory locations. This assembly language program is 
then called by BASIC when needed. It is located at statement numbers 
2003 through 2009. The data are automatically stored from 01507^, 

(3783^) through 0F8A lfi (3978^) and the program goes from 0F8B^ 

(3979 10 ) through 0FFF lfi (4095^). 

On the way to loading the assembly program, all the channels are 
counted and this sum used later. If some numbers arc left out or added 
(.wrong number of parameters), an error will be displayed. If one number 
is left out before any channel 400-499 occurs, this will be missed so if 
the 400 channel group is put first this condition will be checked also. 

It is also possible to have one left out and one added somewhere else and 
not be detected. Careful data entry is always recommended. 

The software has been designed to interrogate the SDAS no more 
than once every 2 sec. The situation arises as to what to do if the SDAS 
is busy or if some other problem occurs. One thought is to keep looking 
(in a loop) until a response is obtained. This, however, would occa- 
sionally cause a nonsense set of outputs because the interrupt request 
timed out just after the SDAS saw it and on the next busy check the 
AIM l>5 saw a strobe in the middle of the data stream and assumed it was 
the first strobe. A minimum delay of about 300 ms is needed to avoid 
this and so 2 sec was always used. When the SDAS is interrogated and 
no response is received during one of the interval modes, the TIMEOUT 
message is printed and then the SDAS is checked every 2 sec until it 
once again responds. The same interval mode then continues as before. 
This would be needed in an unattended interval mode operation. The 
only change is that one interval is longer by the amount of time the SDAS 
did not respond and later intervals are then slipped in time by this amount. 
There is presently no absolute time interrupt scheme being* used by the 
AIM G5. None is needed and the small amount of memory to do it is not 
available . 


15 


Answering the initial BASIC memory number with 3782 gives the 
maximum possible amount of memory for the BASIC program. The data 
and machine language routines go from 3783 to 4095 which takes up the 
rest of the 4K RAM. BASIC uses from 3782 down. 

Channels are found by starting from the beginning of the DATA 
and searching to the end. If a channel is requested but not found, a 
message is given to that effect. In channels 100 and above, a channel 
requested and not found gives a different message showing which desig- 
nated channel had the error in it. These channels, 100 and above, take 
longer to compute because a full search must be made for each of the 
specified sensor channels. This search time could bo eliminated but 
another 2K memory would be needed and the time is not a problem any- 
way. It takes approximately 10 sec at most to do one 100-group channel. 

Results are printed out to one-tenth unit accuracy. This was based 
primarily on temperature needs but is more than adequate for other para- 
meters. 

Present memory limits allow only about 60 channels (total) to bo 
input while keeping the program all on one tape file. Separating the 
statements and data used only for machine language into their own file 
would allow another 25 or so channels to be added. This includes maxi- 
mum data compression in the DATA statements. 

Channel 0 is always the Real Time Clock. The SDAS output for 
the RTC consists of four bytes: High, Mid, Low, Low. These first 

three bytes are converted as one 24-bit word to decimal and printed. 

Each count represents 2 sec real time. 

Channel 1 is always the lower 48-channel SDAS offset. It is sent 
as two bytes: high and low. This is assumed to bo one 16-bit (rather 
than a 10-bit or two 8-bit words) and is converted to decimal as such. 

This is normally only a few counts or zero. 

Channel 999 is always the last one and signals the end of channel 
data. It, like channels 0 and 1, is part of the primary program and 
never changes. 

The number of channels -seen from the SDAS is printed at the begin- 
ning of a full printout. This should be some multiple of 16 unless an 
error has occurred. The proper number is known for each site and can 
be checked from time to time. 

All sensor channels, 2-96 (or to 99 if desired), are converted as 
one 8-bit word and the most significant two bits of the second 8-bit word 
to make up one 10-bit result. The two bits are the least significant bits 
of the 10-bit word. The resulting decimal count is then converted to the 
proper units for that sensor. 


16 



Further details can be obtained from the BASIC program listing, 
Figure D-l, which follows. Lines 1000 through 1032 totally define this 
typical site. All other lines are part of the primary program and never 
change. Also shown is a typical full printout in Figure D-2. 


17 


10 DIMA(5)»B(3)»C(4)fA$( 16){ B=256}Z=3785 ' P0KE04» lSSUF'OKEQU t IS 

11 FQRI a lT0200}GQSUB200 5 IFP=999G0T020 

12 NEXT 

20 S«1 5 X- 1 ! F0RI-0T016 ! READA* (1)5 NEXT 
30 F0RI“3979T04095 5 READP 5 PONEI » F' {NEXT 
40 INPUT* 1MAN»2AUT OR 3ALL * i B 5 0NBG0T070 »55» 55 
50 G0T040 

55 INPUT*INT-M*?T5IFB a 3G0T014O 

60 INPUT *#CH'S< E 10* pN5C%(0)-05 IFN-0G0T0140 

61 F0RI = 1T0N 5 INPUTCX (1)5 NEXT 5 G0TQ140 
70 INPUT *CH* 5 C%(0> 5T=05 N^OS X»1 5G0T0150 

80 F0RQ=0T0N 5 RESTORE 5 F0RI = 1T0S5 GQSUB200 

81 IFP a CX( Q) ANDP<400THENC=PS 60SUB400 5 NEXTQ 5 GOT 01 30 
90 NEXT! PRINT ! C% ( Q > ) *?* 5G0T040 

130 F0RI a lT042#(l+30*ABS(T*X))!P=SGR(.2> SNEXT! IFB=1GOT070 
140 IFX a lTHENPRINT* * 

150 Y=USR( 1 ) 5 IF( Y=O0RY a 20O) ANBX-1THENPRINT ! * TIMEOUT * f Y 5 X~0 5 GQT01 ™ 

131 IFY«0ORY a 2O0GOTD130 
152 X a l 5 IFBO3G0T080 

155 PRINT «5#Y-2f 'CHANNELS* 

160 RESTORE! C a 0 5 F0RQ a lT0S 5 IFC<100GQTG165 

161 RESTORE 5 F0RI*1T0S 5 G0SUB200 ! IFC=PG0T0163 

162 NEXT 

165 GQSUB200!C a P{ IFP<400THENG0SUB400 

170 NEXTQ! IFT a 0GOT040 

171 G0T0130 

180 PRINTCi .1*INT<10*V)*A$(C(4))!RETURN 

200 RE ADP ! F0RM«OT04- ( P>399 ) ! READA ( M ) 5 NEXT ! RETURN 

300 IFP a OTHENY a PEEK ( Z-2 > #B*D+PEEK < 2-1 ) KD+PEEK ( 7. > ! DOT0320 

305 IFP»lTHENY»PEEK(Z+2)Htn+PEEK(Z+3) 5GOT032O 

310 V»Z+2#P } Y»4#PEEK (U)+PEEN(U+1)/645IFA(4) “4THENY-SQR ( Y ) 

315 IFA(4)»lTHENF0RL=0T03!Aa.>=A(L)/10"(3*L+l> SNEXT 
320 V=A<0)+Y*A(l)+Y r '2*A<2)+Y' > 3*A(3> {RETURN 
-400 IFC<100THENGOSUB300 } C( 4 ) =S A( 4 > SG0SUB180 } RETURN 
500 FOR J=OT045C(J)=A(J) {NEXT 
510 FOR J*0T02- ( C<200.) +2* ( 0299 > ! RESTORE 

520 F0RK=1T0S 5 GOSUB200 ! IFP-C ( J > THENG0SUB300 5 B ( J > -V ! G0T0540 
530 NEXTNJG0T0600 

540 NEXT J S ONINT ( C/1 00 > G0SUB550 » 560 , 570 ! RETURN 

550 Y a (B(0)+B<l>)/25C(3)=><A(0>+Y*(A(l>+Y*A(2) > >#< A < 3 > m.< A(4 >+Y#A(5> ) ) 

560 y=<B(0>-B(l))*B(2>*C(3>*(6o+58.92*<C>199>> 5G0SUB1805RETURN 

570 U=B( 0 ) *C < 1 > ! GOSUB180 ! RETURN 

600 PRINT* ERROR CH’JCJENB 

999 DATAO<0»l*O.Of9»lrO»l»0,OflO 


Figure D-l. BASIC program listing. 


18 


1000 DATA400f .7742f4.221E-4f3.984E-7f8,838f-2*382E-3f~S.03F.-6 

1001 DATA401 f 1 • 0115f “2* 34BE~4f 10. 37E“7 f 8 « 346 f « 4129E-3f "'9 • 961E-6 

1002 DATA6f319f1241f23f0f1 

1003 DATA9f 325 f 3991 f 143f Of 1 

1004 PATA12 f317f 1983f33f0f 1 

1005 DATA14 f 323 f 1977 f64 fOf 1 

1006 DATA16 f 327 f 1962 f 48 f Of 1 

1007 DATA17f324f1966f44f0f1 

1008 DATA18f323f1982f33f0f1 

1009 DATA20f321 f 1982 f33f Of 1 

1010 DAT A22 f 32 1 f 1 982 f 33 f 0 f 1 

1011 DATA24f 315 r 2001 » 18 f Of 1 

1012 DATA26f335f 1981f65fOf1 

1013 DATA28f325f 1964 f81 fOf 1 

1014 DAT A30 f 330 f1979f65f0f1 

1015 DATA32f330f1959f63f0f1 

1016 DAT A10f**170f1363f16f0f1 

1017 DATA3fOf.9334fOfO»5 

1018 DAT A5fOf1*919iOfO»4 

1019 6ATA7f0f *923I4f OfOfS 

1020 DATA11 f Of 15f0f0f4 

1021 DATA13fOf9i744f Of Of 4 

1022 DATAISfOf ,9225f0f0f11 

1023 DATA19f0f .00391 f0f0f2 

1024 DATA21 fOf «001955f0f0f2 

1025 DATA23f0f .0009765fOfOf2 

1026 DATA8f0f2*961 fOfOfO 

1027 DAT A100f14f12f11f400f3 

1028 DATA101f28f26f13f401f3 

1029 DATA102f32f30f5f401f3 

1030 DATA2f 324f 1255f 14f Of 1 

1031 DATA4f336f2032f18f0f1 

1032 DAT A30Q 1 8 ■ 6000 > 0 f 0 f 3 

2000 DAT A999fOfOfOfOfOfO 

2001 DATABTU/FT2-HRfDEBFfKWfBTU/HRfGPMfOALfFPMfDEG 

2002 DATAVOLTSfRTCfCOUNTSfCFfPERfCFMfKPHfSUfMISC 

2003 DATA173f13f160f141f13f160f169f0f141f3f160f141f2f160f169f3 

2004 DATA141 f11f160f169f29f141f12f160f162f0f 160f Of 232f 224f Of 240f74* 1&9 

2005 DATA18f205f 13 f 160f 208f244f 169 f31f141f12f160f169f 255 f 141f9f160f 173 

2006 DATAOf160f41f96f240f9f173f13f160f41f32f240f242f208f18f162f2f169 

2007 DATA18f 141 f13f160f173f13f160f201f18f240f8f201f 32 f 208 f 245 f 160 f 200 

2008 DATA208 f 19f 173f 1 f 160f 73f255 f 153 f 199 f 14f 200f 202 f208 f 224 f 173f0f 160 

2009 DAT A41f224f208f194f169f31f141f12f160f169f0f76f 209 f 197 


Figure D-l. (Concluded) 


32 CHANNELS 

0 52552 RTC 

1 0 COUNTS 

6 120,7 BEGF 

9 .IS 1.4 DE6F 


12 

127.8 

BE OF 

1.4 

144.8 

BE OF 

.1.6 

122,1 

BE OF 

1.7 

112.9 

BE OF 

18 

120.3 

BE OF 

20 

120.7 

BE OF 

':>o 

A.. At 

1 1 3 , 9 

BE OF 

24 

11.2,6 

BE OF 

26 

107,4 

BE OF 

28 

129.4 

BE OF 

30 

133.3 

LiE OF 

32 

155 BE Of 

1.0 

64,3 

BE OF 

3 

640 , 3 

GAL 

5 

11.1 (3 PM 

7 

378 , 1 

GAL. 

11 

111. 2 

OHM 

1.3 

71.6 

GF :, M 

15 

753 . 6 

CF ; 

1.9 

2.8 KW 

21 

.8 KW 


/•> -y 

A.. W 

,1 KW 



8 284.2 BTU/FT2-HR 

100 800210.4 BTU/H 
R 

101 777847.9 BTU/H 
R 

102 119215.4 BTU/H 
R 

2 56,6 DECT 

4 124.5 DF.GF 

300 1705536 BTU/H R 


END 


Figure D-2, Typical full printout for 32-channel system. 


APPENDIX E 


INPUT FORMATS 


1. DATA statements define the site and performance parameters. 

2. The DATA statements become part of the total program and can 
be stored on tape as a whole so only one tape load is required per site. 

3. Statement numbers (BASIC) from 1000 to 1999 are reserved for 
the DATA statements which define the site to the computer. 

4. Order of inputting channel numbers is arbitrary (see no. 10 
below). A total printout will have the order the same as they are input. 
Program execution will be slightly faster if channels 2-99 appear first. 

5. The desired performance parameters are assigned a channel 
number and they are accessed by that channel number. A log must be 
kept of these channels versus parameter for each site since they are 
not in the IP but are user defined. 

6. New channels can be defined using the already programmed 
equations in any way desired (to monitor counts, multiply by constant, 
etc . ) . 


7. The total number of channels is limited only by computer 
memory which is adequate but not overly so. Data input can be altered 
to increase memory efficiency, in particular by putting data for up to 
three channels in one DATA statement. An OM error (out of memory) 
requires better memory efficiency. 

8. All numerical values need only have four significant digits. 

This gives sensor accuracy of 0.1 units, approximately, and performance 
accuracies of about 0.1 percent. 

9. A TM error (type mismatch) will occur if the wrong number of 
terms is used in a channel. 

10. It is better to put channels 400-499 first in the computer when 
there are any. Data checking by the computer is more complete this way. 

Channels 2 • 99 order: 

CH #, A0, Al, A2, A3, units # (see special format for temperatures) 


Channels 100-199 order (liquid): 


CH 


#, CH 


Tout’ 


CH Tin- 


CH 


flow 


CH 


coef ’ 


units # 


Channels 200-299 order (air): 


21 


CH *’ CII Tout- cf W CH floW KA ’ units » 
Channels 300-399 order (insolation) ; 

CH #, CH pyro , A, 0 , 0, units # 

Channels 400-499 order (liquid coefficients, C** coe f) : 
OH Aq, bg, b^, bg 


Temperature coefficients are specially scaled before they are input to the 
computer in order to save memory and make it easier to input them. 

The values which go into the computer are: 


A0 = IP x 10 1 , A1 = IP x 10 4 , A2 = IP x 10 7 , A3 “ IP x 10 10 


They are later rescaled to their true value by the computer. This format 
allows temperature coefficients to be input with no decimal points and no 
exponents and still give 0.1°F accuracy. This automatic scaling is trig- 
gered whenever a 1 occurs in units #. 

Whenever a liquid flow rate is being determined (by finding a 4 in 
units #) the square root of counts is used instead of just counts. 

Channel 0 is always the real-time clock output. 

Channel 1 is always the lower 48-channel offset counts. 

2 

KA is the air duct area in ft . 

2 

A is the solar collector area in ft . 

CH is the channel where the desired information is located, 

X 

a^-bg are the liquid coefficients taken from the tables. 

The equation for channels 2-99 is: 

Y = A0 + A1 (X) + A2 (X 2 ) . A3 (X 3 ) (X - decimal counts) 

The equation for channels 100-199 is: 

Y = < CH Tour CH Tin> *CH flow *Cp*p*60 

where Cp and p are determined using coefficients found in CH The 

equation for channels 200-299 is: 


Y - (CH Tout- C!i Tin)* CH flow* KAn - 08 ' 
T„. J equation for channels 300-399 is: 


Y ■ CH pyro* A 


The equations for channels 400-499 are: 


Cp « a Q + a-jT + a 2 T 2 
p = b Q + b x T + b 2 T 2 

where T = (T ^ + T j n )/ 2 ( avera £ e temp) 

Units for channels 2-99 are as in the IP. Units for channels 
> = 100 are normally in BTU/HR. Only unit #'s 1 and 4 do anything 
except print. 

The particular units which can be printed and their access numbers 
(as required in channel data) are: 


0 - BTU/FT 2 -HR insolation 

1 - DEGF °F» also causes automatic coefficient scaling 


3 

4 

5 

6 

7 

8 
9 

10 

11 

12 


KW 

BTU/HR 


GPM Also causes >/ counts to be used 


GAL 

FPM 

DFG 

VOLTS 

RTC 

COUNTS 

CF 

PER 


Real-Time Clock 


23 


percent 



13 - CFM 


14 - MPH 

15 - SW switch 

16 - MISC use for others not listed. 

Examples: 

1000DATA2,326,1979,50,0,1 [CH2,32.6, . 1979,50E-7, 0E-10, temperature] 

1001DATA21,0,. 2955,0,0,4 [CH21,0, . 2955,0,0, liquid flow rate] 

1002DATA10C,12,45,21,400,3 [CH100 ? CH12,CH45,CH21,CH400,BTU/HR] 

1003DATA200,2,26,13,2,3 [CH200,CH2,CH26,CH13,2FT 2 > B7 1T J/HR] 

1004DATA300, 7, 720, 0, 0, 3 [CH300,CH7, 720FT 2 , 0, 0 ,BTU /HR] 

1005DATA400, 1.011,- 2. 348E-4 , 10. 37E-10, 8. 346, . 4129E-3.-9. 961E-6 
Combining DATA statements, say 1003 and 1004 would produce: 

1003DATA200,2,26,13,2,3,300,7,720,0,0,3 (keep < - 72 characters) . 

Always omit blanks as tL„„ use memory too. 


V 

24 




APPENDIX F 


OPERATING INSTRUCTIONS 


1. Connect cable, cassette and power. 

2. Turn on AIM 65, turn printer off (CTRL, PRINT together). 

3. Rewind tape, zero counter, volume full, move tape to within 3 
counts of pgm start. 

4. Press 5, memory = 3782, RETURN; width = RETURN. 

5. Type LOAD, RETURN; IN = T , F = filename, T = 1, RETURN. 

6. Start tape playback and note statements moving thru display. 

If not, reload. 

7. When cursor (' ) returns shut off tape. 

8. Program is ready to run. Turn on printer if desired (CTRL 
PRINT). 

.9. Type RUN, RETURN. 

10. Three options are available: MANual = 1, AUTomatic = 2, 

print ALL - 3. 

11. Enter choice and press RETURN. RETURN alone gets cursor back. 

12. Manual asks only for a channel number, 0-399. When finished with 
one, it asks for another. When done, press RETURN alone. Go 
to 

13. (a) Automatic asks first for time interval in minutes between print- 

outs. Zero gives minimum time of 2 sec. Actual time between 
printouts is 2 sec + time interval requested + print time (if 
any). 

(b) Enter number of channels less than or equal to 10 to be moni- 
tored at once. Channel zero (Real Time Clock) is always given 
first automatically as a time interval reference on the printout. 
One RTC count = 2 sec. 

(c) Enter specific channels desired one at a time with a RETURN 
for each. 

(d) Press FI key to interrupt computer when done. Go to 9. 


25 , 


14. printALL asks only for the time interval in minutes. Actual time 

between prints is us explained in 13(a). However, entering a zero 
in this case just gives one printout. Anything greater than zero 
gives a print interval as before. When interval is being used, 
press Ft as before to stop. Full printout always includes ETC 
(0110) and SDAS offset (C1I1) as well as number of channels read 
by SDAS. The minimum time between S1)AS reads is 2 seconds 
under any conditions. Each print interval output is based on just 
one SDAS read no matter how long is required to compute and print 
the results. 

Once the program is loaded, new channels can be added, within 
memory limits, by getting the cursor in the display, choosing an unused 
line number (1000 '1999) and typing the DATA statement according to the 
proper format (see INPUT FORMAT). Pressing RETURN when through 
typing the lino enters it into the main program. It can then be treated 
like any other channel. Entering line number, RETURN deletes that line. 

If the ESC (escape) key is ever pressed (to return to the monitor, 
for example) or if the reset (panic button on left side of case) is pressed, 
BASIC can be re-entered just by pressing 0. This gets the cursor back 
in the display so changes can be made or RUN typed in. 

If a read is attempted when the SDAS is busy, or if bad data is 
detected, this fact will bo printed out by the word TIMEOUT followed by 
the number zero or 200. Zero means the SDAS was busy and 200 means 
a noise or hardware problem occurred. In either of the interval modes, 
the AIM 65 will keep trying the SDAS (each 2 seconds) until it responds. 
If a cable is broken, it will just wait until the operator intervenes with 
FI. 


Data can be stored on tape using the monitor dump (D) command 
find read back in later using the monitor load (L) command. The data 
starting (FROM) address is S0EC7 and the ending (TO) address is S0F8A . 
Before giving RETURN after specifying tape unit number, turn on 
recorder. Answer MORE? with N. Both record and playback can be done 
using remote control of the player by turning tape unit 1 off before using 
D or L commands. Before recording, change SA409 from $08 to $20 or 
the data (or BASIC program) will not reload. The monitor M command is 
used for this change. Type M, A 409, RETURN. Then /, 20, RETURN. 

Any tape storage with the AIM 65 using the present cassette 
recorder requires that the tape gap be increased from the default value 
stored in the monitor (not necessary for playback). The $08 must be 
increased to at least $10 and preferably $20 (see above). This applies 
to BASIC as well as monitor recording. A different recorder may not 
require this change. 


26 


A lop; must In' kept of programs, counter values for program or 
data locations, dates, prop;ram typo, t’ilo natno. oto., for liter rooords. 

Tho only known way tho prop;ram oan lump; up is if thoro is a 
problem in tho hardware or SDAS. Pressinp; tho reset will then ho noo 
ossary in order to regain oonlrol. 


Onoo all site data has boon ordered into tho computer, tho entire 
program can then be saved (.by HASH') usinjv the SAVE command. Type 
SAVE, RETURN; then T, five character file name, 1, before pressing 
RETURN, start reeordinp; at the desired tape counter location. A more 
accurate way (.so far as file start location') is to first p,\) back to the moni 
tor (ESt") and turn off tape unit l (.1 key') then press the record keys 
on the recorder so it will start remotely by itself, Then re enter bASU' 
(0 key') and p;o through the SAVE procedure. be sure that memory 
location ‘WtOO was ehanp;ed to S.'O as mentioned before for recording. 


line 


The program can be exercised without an SDAS by ehnnp;inp; program 
11)0. bo this by typing: 


1 ROY 100. RETURN 


This assumes a 48 channel system. The value for V (number of data 
strobes') is '.! + (number channels') i •! in case some other number of chan 
nols is beinp' used. V can bo anythinp; except «oro or 1100. 




APPROVAL 


SOLAR SIH TEST MODULE 


By Ralph R. Kissel and Donald R. Scott 


The information in this report has been reviewed for technical con- 
tent. Review of any information concerning Department of Defense or 
nuclear energy activities or programs has been made by the MSFC Security 
Classification Officer. This report, in its entirety, has been determined 
to be unclassified. 


•3 , 

F. BROOKS MOORE ~ 

Director, Electronics and Conti’ol Laboratory 


jzaALA 




/ j/ERRYxL . | MACK 
(y/Chief,\Gmdance, Control and Instrumentation Division 



Chief, Electronics and Servo- Analysis Branch 



Manager, Solar Energy Applications Projects 


2'^ GOVERNMENT PRINTING OFFICE 1980-040-247/78 REGION NO. 4 


